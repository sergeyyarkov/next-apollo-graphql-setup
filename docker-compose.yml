version: '3'
services:
    app:
        container_name: apollo-next-graphql
        restart: always
        build: .
        ports: 
            - '3000'
    webserver:
        container_name: webserver
        restart: unless-stopped
        build: nginx
        ports: 
            - '80:80'
    strapi:
        container_name: strapi
        image: strapi/strapi
        environment:
            - DATABASE_CLIENT=mongo
            - DATABASE_HOST=db
            - DATABASE_PORT=27017
            - DATABASE_NAME=strapi
            - DATABASE_USERNAME=
            - DATABASE_PASSWORD=
            - DATABASE_AUTHENTICATION_DATABASE=strapi
        ports:
            - '1337:1337'
        volumes:
            - ./cms:/srv/app
        depends_on:
            - db
    
    db:
        container_name: mongo
        image: mongo
        environment:
            - MONGO_INITDB_DATABASE=strapi
        ports:
            - '27017'
        restart: always